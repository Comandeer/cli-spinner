{"version":3,"file":"cli-spinner.mjs","sources":["../src/defaultSpinner.js","../src/Spinner.js"],"sourcesContent":["const defaultSpinner = [\n\t'/',\n\t'-',\n\t'\\\\',\n\t'|'\n];\n\nexport default defaultSpinner;\n","import { Writable as WritableStream } from 'stream';\nimport { Duplex as DuplexStream } from 'stream';\nimport consoleControl from 'console-control-strings';\nimport defaultSpinner from './defaultSpinner.js';\n\nconst timeoutSymbol = Symbol( 'timeout' );\nconst currentFrameSymbol = Symbol( 'currentFrame' );\nconst shownSymbol = Symbol( 'showing' );\nconst eraseLineCmd = consoleControl.gotoSOL() + consoleControl.eraseLine();\n\nclass Spinner {\n\tconstructor( {\n\t\tstdout = process.stdout,\n\t\tlabel = '',\n\t\tspinner = defaultSpinner,\n\t\tinterval = 80\n\t} = {} ) {\n\t\tif ( !isValidStream( stdout ) ) {\n\t\t\tthrow new TypeError( 'Custom stdout must be a valid writable/duplex stream' );\n\t\t}\n\n\t\tif ( typeof interval !== 'number' ) {\n\t\t\tthrow new TypeError( 'Custom interval must be a valid number' );\n\t\t}\n\n\t\tif ( typeof label !== 'string' ) {\n\t\t\tthrow new TypeError( 'Custom label must be a valid string' );\n\t\t}\n\n\t\tif ( !isArrayOfStrings( spinner ) ) {\n\t\t\tthrow new TypeError( 'Custom spinner must be a valid array of strings' );\n\t\t}\n\n\t\tthis.stdout = stdout;\n\t\tthis.label = label;\n\t\tthis.spinner = spinner;\n\t\tthis.interval = interval;\n\t\tthis[ timeoutSymbol ] = null;\n\t\tthis[ currentFrameSymbol ] = 0;\n\t\tthis[ shownSymbol ] = false;\n\t}\n\n\tshow() {\n\t\tif ( this[ shownSymbol ] ) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst drawSpinner = () => {\n\t\t\tconst frame = this._prepareSpinnerFrame();\n\n\t\t\tthis._requestRenderFrame( frame ).then( () => {\n\t\t\t\tthis[ timeoutSymbol ] = setTimeout( drawSpinner, this.interval );\n\t\t\t} );\n\t\t};\n\n\t\tthis[ shownSymbol ] = true;\n\t\tthis._requestRenderFrame( consoleControl.hideCursor() ).then( drawSpinner );\n\t}\n\n\thide() {\n\t\tif ( !this[ shownSymbol ] ) {\n\t\t\treturn;\n\t\t}\n\n\t\tif ( this[ timeoutSymbol ] ) {\n\t\t\tclearTimeout( this[ timeoutSymbol ] );\n\t\t}\n\n\t\tthis._requestRenderFrame( eraseLineCmd + consoleControl.showCursor() ).then( () => {\n\t\t\tthis[ currentFrameSymbol ] = 0;\n\t\t\tthis[ shownSymbol ] = false;\n\t\t} );\n\t}\n\n\t_prepareSpinnerFrame() {\n\t\tconst currentFrame = this.spinner[ this[ currentFrameSymbol ]++ % this.spinner.length ];\n\n\t\treturn `${ eraseLineCmd + currentFrame } ${ this.label }`;\n\t}\n\n\t_requestRenderFrame( frame ) {\n\t\treturn new Promise( ( resolve ) => {\n\t\t\tif ( this.stdout.write( frame, 'utf8' ) ) {\n\t\t\t\treturn resolve();\n\t\t\t}\n\n\t\t\tthis.stdout.once( 'drain', resolve );\n\t\t} );\n\t}\n}\n\nfunction isValidStream( value ) {\n\treturn value instanceof WritableStream || value instanceof DuplexStream;\n}\n\nfunction isArrayOfStrings( value ) {\n\treturn Array.isArray( value ) && value.every( ( element ) => {\n\t\treturn typeof element === 'string';\n\t} );\n}\n\nexport default Spinner;\n"],"names":["defaultSpinner","timeoutSymbol","Symbol","currentFrameSymbol","shownSymbol","eraseLineCmd","consoleControl","gotoSOL","eraseLine","Spinner","constructor","stdout","process","label","spinner","interval","value","WritableStream","DuplexStream","TypeError","Array","isArray","every","element","isArrayOfStrings","show","this","drawSpinner","frame","_prepareSpinnerFrame","_requestRenderFrame","then","setTimeout","hideCursor","hide","clearTimeout","showCursor","currentFrame","length","Promise","resolve","write","once"],"mappings":";qFAAA,MAAMA,EAAiB,CACtB,IACA,IACA,KACA,KCCKC,EAAgBC,OAAQ,WACxBC,EAAqBD,OAAQ,gBAC7BE,EAAcF,OAAQ,WACtBG,EAAeC,EAAeC,UAAYD,EAAeE,YAE/D,MAAMC,EACLC,aAAaC,OACZA,EAASC,QAAQD,OADLE,MAEZA,EAAQ,GAFIC,QAGZA,EAAUd,EAHEe,SAIZA,EAAW,IACR,UA2EmBC,EA1EDL,aA2EEM,GAAkBD,aAAiBE,SA1EnD,IAAIC,UAAW,wDAyExB,IAAwBH,KAtEG,iBAAbD,QACL,IAAII,UAAW,6CAGA,iBAAVN,QACL,IAAIM,UAAW,2CAqExB,SAA2BH,UACnBI,MAAMC,QAASL,IAAWA,EAAMM,OAASC,GACrB,iBAAZA,IApERC,CAAkBV,SACjB,IAAIK,UAAW,wDAGjBR,OAASA,OACTE,MAAQA,OACRC,QAAUA,OACVC,SAAWA,OACVd,GAAkB,UAClBE,GAAuB,OACvBC,IAAgB,EAGvBqB,UACMC,KAAMtB,gBAILuB,EAAc,WACbC,EAAQF,KAAKG,4BAEdC,oBAAqBF,GAAQG,MAAM,UACjC9B,GAAkB+B,WAAYL,EAAaD,KAAKX,mBAIlDX,IAAgB,OACjB0B,oBAAqBxB,EAAe2B,cAAeF,KAAMJ,GAG/DO,OACOR,KAAMtB,KAIPsB,KAAMzB,IACVkC,aAAcT,KAAMzB,SAGhB6B,oBAAqBzB,EAAeC,EAAe8B,cAAeL,MAAM,UACtE5B,GAAuB,OACvBC,IAAgB,MAIxByB,6BACOQ,EAAeX,KAAKZ,QAASY,KAAMvB,KAAyBuB,KAAKZ,QAAQwB,cAEvE,GAAGjC,EAAegC,KAAkBX,KAAKb,QAGlDiB,oBAAqBF,UACb,IAAIW,SAAWC,OAChBd,KAAKf,OAAO8B,MAAOb,EAAO,eACvBY,SAGH7B,OAAO+B,KAAM,QAASF"}